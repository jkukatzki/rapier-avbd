# MCP Server Setup

This guide explains how to install and run the local Model Context Protocol (MCP) server that orchestrates AVBD builds, benchmarking runs, and scoreboard management.

## 1. Install prerequisites

1. **Rust toolchain** – Install Rust using [`rustup`](https://rustup.rs/) and ensure `cargo` is on your `PATH`.
2. **wasm-pack** – Required for the WebAssembly builds generated by the helper script:
   ```bash
   cargo install wasm-pack
   ```
3. **Node.js & pnpm** – The MCP server is implemented in Node.js and distributed through the repository package. Install Node.js 18+ and pnpm (v8 or newer).
4. **pnpm dependencies** – From the repository root, install the JavaScript dependencies:
   ```bash
   pnpm install
   ```

## 2. Build the solver benchmark harness

The MCP server shells out to the dedicated `solver-bench` crate when it records results. Build the release binary once so subsequent runs only execute the simulation workload:

```bash
cargo build --release -p solver-bench --no-default-features --features solver_impulse,profiler
```

Repeat with the AVBD feature enabled if you plan to benchmark the new solver immediately:

```bash
cargo build --release -p solver-bench --no-default-features --features solver_avbd,profiler
```

## 3. Start the MCP server

Launch the server from the repository root. It exposes three commands: `build-wasm`, `run-bench`, and `get-scoreboard`.

```bash
pnpm run mcp:server
```

The server listens on STDIO following the MCP JSON-RPC handshake. Tools such as the OpenAI Desktop application or custom clients can connect to it directly.

## 4. Run one-off commands (optional)

The same entrypoint can be invoked as a regular CLI without standing up the MCP session:

```bash
# Build the AVBD WebAssembly package
node tools/mcp/server.js build --solver avbd

# Benchmark the impulse solver for 180 steps
node tools/mcp/server.js bench --solver impulse --steps 180
```

Each benchmarking run appends a structured entry to `benchmarks3d/scoreboard.json` and copies the compiled `solver-bench` binary plus its metrics to `benchmarks3d/artifacts/<timestamp>-<solver>/`.

## 5. Scoreboard inspection

Retrieve the full history of recorded runs through MCP or by inspecting the JSON file directly:

```bash
node tools/mcp/server.js bench --solver avbd --steps 60   # records a new entry
node tools/mcp/server.js serve                           # expose MCP commands for external tools
```

You can also call the MCP `get-scoreboard` command to receive the current state without modifying the file.
